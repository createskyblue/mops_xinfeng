!function(e){function t(t){for(var r,o,i=t[0],s=t[1],l=t[2],d=0,f=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(u&&u(t);f.length;)f.shift()();return c.push.apply(c,l||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(r=!1)}r&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={0:0},c=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=s;c.push([62,1]),n()}({11:function(e,t,n){"use strict";(function(e){n.d(t,"g",(function(){return o}));var r=n(46),a=n(19),c=n(27);n(12);n.d(t,"a",(function(){return c.a})),n.d(t,"b",(function(){return c.b})),n.d(t,"c",(function(){return c.c})),n.d(t,"d",(function(){return c.d})),n.d(t,"e",(function(){return c.e})),n.d(t,"f",(function(){return c.f})),n.d(t,"h",(function(){return c.g})),n.d(t,"i",(function(){return c.h})),n.d(t,"j",(function(){return c.i}));class o{constructor(t){this.events=new r.EventEmitter,this.handleValueChanged=t=>{const n=t.target;this.emitBlock(e.from(n.value.buffer))},this.device=t,t.addEventListener("gattserverdisconnected",()=>{this.events.emit("disconnected")})}static async requestDevice(){const e=await navigator.bluetooth.requestDevice({filters:[{services:[30326]}],optionalServices:[a.b]});return new o(e)}async connect(){var e;if(this.server=await(null===(e=this.device.gatt)||void 0===e?void 0:e.connect()),void 0===this.server)return;const t=await this.server.getPrimaryService(a.b),n=await t.getCharacteristic(a.c);n.addEventListener("characteristicvaluechanged",this.handleValueChanged),await n.startNotifications()}async disconnect(){var e;try{null===(e=this.device.gatt)||void 0===e||e.disconnect()}catch(e){}this.events.removeAllListeners()}async sendCommand(e){var t;const n=await(null===(t=this.server)||void 0===t?void 0:t.getPrimaryService(a.b));if(void 0===n)return;const r=await n.getCharacteristic(a.a);await r.writeValue(e)}on(e,t){return this.events.on(e,t),()=>{this.events.off(e,t)}}emitBlock(e){try{const t=Object(c.j)(e);void 0===t?this.events.emit("failed",e):this.events.emit("packet",t)}catch(t){this.events.emit("failed",e)}}}}).call(this,n(39).Buffer)},12:function(e,t,n){"use strict";(function(e){n.d(t,"g",(function(){return a})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return u}));var r=n(48);function a(){return d(1)}function c(t){return d(8,e.of(0,t))}function o(t=new Date){const n=e.alloc(4);return n.writeUInt32BE(Math.trunc(t.getTime()/1e3)),d(9,n)}function i(){return d(10)}function s(){return d(11)}function l(t){return d(22,e.of(t?1:0))}function u(t){return d(16,e.from([t,0,0,0,0]))}function d(t,n=e.of()){const a=e.of(170,t,...n);return e.of(...a,255&r.a.sum(a))}}).call(this,n(39).Buffer)},19:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c}));const r="6e400001-b5a3-f393-e0a9-e50e24dcca9e",a="6e400002-b5a3-f393-e0a9-e50e24dcca9e",c="6e400003-b5a3-f393-e0a9-e50e24dcca9e"},27:function(e,t,n){"use strict";n.d(t,"g",(function(){return a})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return o})),n.d(t,"i",(function(){return i})),n.d(t,"a",(function(){return s})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return u})),n.d(t,"c",(function(){return d})),n.d(t,"h",(function(){return f})),n.d(t,"j",(function(){return b}));var r=n(48);class a{constructor(e){m(e,1)}}class c{constructor(e){m(e,10)}}class o{constructor(e){m(e,11),this.pm25=e.readUInt16BE(2),this.recordDate=new Date(1e3*e.readUInt32BE(6))}}class i{constructor(e){m(e,80),this.windSpeed=e.readUInt8(5),Object.freeze(this),Object.seal(this)}}class s{constructor(e){m(e,80),this.capacity=e.readUInt8(3),this.isCharging=Boolean(e.readUInt8(6)),Object.freeze(this),Object.seal(this)}}class l{constructor(e){m(e,80),this.runtime=e.readUInt32BE(3),this.boottime=e.readUInt32BE(7),Object.freeze(this),Object.seal(this)}}class u{constructor(e){m(e,80),this.pm25=e.readUInt16BE(3),this.recordDate=new Date(1e3*e.readUInt32BE(7)),this.currentDate=new Date(1e3*e.readUInt32BE(12)),Object.freeze(this),Object.seal(this)}}class d{constructor(e){m(e,80),this.interval=e.readUInt16BE(3),this.enabled=Boolean(e.readUInt8(5)),Object.freeze(this),Object.seal(this)}}class f{constructor(e){m(e,84),this.minor=e.readUInt16BE(2),this.major=e.readUInt16BE(4),Object.freeze(this),Object.seal(this)}toString(){return`${this.major}.${this.minor}`}}function m(e,t){if(170!==e[0])throw new Error("unexpected header");if(e[1]!==t)throw new Error("unexpected type");if(e[e.length-1]!==(255&r.a.sum(e.slice(0,-1))))throw new Error("unexpected checksum")}const h={aa01:a,aa08:class{constructor(e){m(e,8),this.interval=e.readUInt32BE(2)}},aa09:class{constructor(e){m(e,9),this.date=new Date(1e3*e.readUInt32BE(2))}},aa0a:c,aa0b:o,aa16:class{constructor(e){m(e,22),this.enabled=Boolean(e.readUInt8(2))}},aa5001:i,aa5004:s,aa5005:l,aa5006:u,aa5007:d,aa54:f};function b(e){return new(h[e.slice(0,3).toString("hex")]||h[e.slice(0,2).toString("hex")])(e)}},47:function(e,t,n){e.exports={container:"_3Q4jVp-XdRE9lL_y-DHvqZ",table:"_12l9Lp-US87GiC9o0PbHWo",field:"_1BDqlaGx2FzEtv1WMIea58"}},62:function(e,t,n){"use strict";n.r(t);n(49);var r=n(41),a=n.n(r),c=n(0),o=n.n(c),i=n(25),s=n.n(i),l=n(13),u=n(17),d=n(20),f=n(16),m=n(43),h=n(15),b=n(40),p=n(28),v=n(44),E=n.n(v),g=n(45),y=n(11),w=n(12);const j=E()("SENSOR"),O=Object(g.a)(j),S=j("SET_CONNECTED"),C=j("UPDATE_PACKET"),I=O("REQUEST_DEVICE",async()=>y.g.requestDevice()),D=O("CONNECT",async(e,t,n)=>{const{sensor:r}=n();null!==r&&(await r.connect(),t(S(!0)),r.on("disconnected",()=>t(S(!1))),r.on("packet",async e=>(e instanceof y.b&&await r.sendCommand(w.a()),t(C(e)))),r.on("failed",e=>{console.log("Block",e.toString("hex").toUpperCase())}),await r.sendCommand(w.e()))}),B=O("DISCONNECT",async(e,t,n)=>{const{sensor:r}=n();return null==r?void 0:r.disconnect()}),U=O("SEND_MESSAGE",async(e,t,n)=>{const{sensor:r}=n();return null==r?void 0:r.sendCommand(e)});var x=Object(p.reducerWithInitialState)(null).case(I.async.done,(e,t)=>t.result),N=n(33),T=n(48);var P=Object(p.reducerWithInitialState)({connected:!1,shuttingdown:!1,latest:{},history:[],historyFully:!1}).case(S,(e,t)=>Object(N.a)(e,e=>{t||(e.shuttingdown=!1,e.latest={}),e.connected=t})).case(C,(e,t)=>Object(N.a)(e,e=>{e.shuttingdown=!1,t instanceof y.a?(e.latest.batteryCapacity=t.capacity,e.latest.batteryCharging=t.isCharging):t instanceof y.c?(e.latest.measurementInterval=t.interval,e.latest.measurementIntervalEnabled=t.enabled):t instanceof y.j?e.latest.windSpeed=t.windSpeed:t instanceof y.e?(e.latest.runTime=t.runtime,e.latest.bootTime=t.boottime):t instanceof y.f?(e.latest.pm25=t.pm25,e.latest.recordDate=t.recordDate):t instanceof y.i?e.latest.version=[t.major,t.minor].join("."):t instanceof y.h?e.shuttingdown=!0:t instanceof y.b?(e.history.push({pm25:t.pm25,recordDate:t.recordDate}),e.history=T.a.sortedUniqBy(e.history,e=>{var t;return null===(t=e.recordDate)||void 0===t?void 0:t.getTime()})):t instanceof y.d&&(e.historyFully=!0)}));const _=Object(h.b)(),k=f.d;var A=n(31),M=n.n(A),z=n(84),q=n(85),L=n(86),V=n(87),W=n(88),F=n(90),G=n(89),R=n(47),H=n.n(R);const J=()=>{var e,t,n;const r=Object(l.d)(),a=Object(l.e)(e=>e.report.connected),c=Object(l.e)(e=>e.report.shuttingdown),i=Object(l.e)(e=>e.report.latest);return o.a.createElement(z.a,{className:H.a.container},o.a.createElement(q.a,null,o.a.createElement(L.a,null,o.a.createElement(V.a,{color:a?"success":"primary",onClick:async()=>{a?await r(B()):(await r(I()),await r(D()))}},a?"断开连接":"连接设备"),o.a.createElement(V.a,{disabled:!a,color:a?"danger":void 0,onClick:()=>r(U(w.g()))},c?"关机中":"关机"))),o.a.createElement(q.a,null,o.a.createElement("h3",null,"MOPS 忻风随身空气净化器"),o.a.createElement(W.a,{responsive:!0},o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("td",null,o.a.createElement("strong",null,"电池")),o.a.createElement("td",null,o.a.createElement(F.a,{value:null!==(e=i.batteryCapacity)&&void 0!==e?e:0},i.batteryCapacity?i.batteryCapacity+"%":"N/A"," ",i.batteryCharging?"(Charging)":"(Discharge)"))),o.a.createElement("tr",null,o.a.createElement("td",null,o.a.createElement("strong",null,"调节风量")),o.a.createElement("td",null,o.a.createElement(G.a,{type:"range",min:0,max:100,step:1,value:null!==(t=i.windSpeed)&&void 0!==t?t:0,id:"windSpeed",onChange:e=>{return r((t=parseInt(e.target.value),U(w.f(t))));var t}}))),o.a.createElement("tr",null,o.a.createElement("td",null,o.a.createElement("strong",null,"当前风量")),o.a.createElement("td",{className:"text-monospace"},i.windSpeed?i.windSpeed+"%":"N/A")),o.a.createElement("tr",null,o.a.createElement("td",null,o.a.createElement("strong",null,"运行时间")),o.a.createElement("td",{className:"text-monospace"},i.runTime?M()(1e3*i.runTime):"N/A")),o.a.createElement("tr",null,o.a.createElement("td",null,o.a.createElement("strong",null,"启动时间")),o.a.createElement("td",{className:"text-monospace"},i.bootTime?M()(1e3*i.bootTime):"N/A")),o.a.createElement("tr",null,o.a.createElement("td",null,o.a.createElement("strong",null,"固件版本")),o.a.createElement("td",{className:"text-monospace"},null!==(n=i.version)&&void 0!==n?n:"N/A"))))),o.a.createElement(q.a,null,o.a.createElement("p",null,"在项目`MOPS·VIDA PM Watchdog`的基础上增加风量调节功能 原项目地址是 https://github.com/NiceLabs/mops-vida-pm-watchdog"),o.a.createElement("p",null,"本项目地址是 https://github.com/createskyblue/mops_xinfeng")))},Q=Object(f.e)(($=_,Object(f.c)({router:Object(d.b)($),sensor:x,report:P})),void 0,k(Object(f.a)(Object(b.a)(_),m.a)));var $;const K=()=>o.a.createElement(l.a,{store:Q},o.a.createElement(d.a,{history:_},o.a.createElement(u.c,null,o.a.createElement(u.a,{exact:!0,path:"/",component:J}))));a()(()=>{const e=document.createElement("main");document.body=document.createElement("body"),document.body.appendChild(e),s.a.render(o.a.createElement(K),e)})}});
//# sourceMappingURL=main.js.map